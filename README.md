# EEG Spindle Detection with Active Learning (modAL + PyTorch)

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø–æ—Å–≤—è—â–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–æ–Ω–Ω—ã—Ö –≤–µ—Ä–µ—Ç–µ–Ω (—Å–ø–∏–Ω–¥–ª–æ–≤) –≤–æ –≤—Ç–æ—Ä–æ–π —Ñ–∞–∑–µ —Å–Ω–∞ (N2) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ç–æ–¥–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è (Active Learning). 

–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ (MLP) –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `modAL` –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–∞–∏–±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –≠–≠–ì, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –æ–±—ä–µ–º —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–º.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

*   `1-17/`, `–ù–µ–ø–æ–Ω—è—Ç–Ω–æ/` ‚Äî –ø–∞–ø–∫–∏ —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ü–°–ì (`PSG.edf`) –∏ —Ä–∞–∑–º–µ—Ç–∫–æ–π —Å—Ç–∞–¥–∏–π —Å–Ω–∞ (`Base.edf`).
*   `annotationsss2/` ‚Äî —ç—Ç–∞–ª–æ–Ω–Ω–∞—è —ç–∫—Å–ø–µ—Ä—Ç–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ —Å–ø–∏–Ω–¥–ª–æ–≤ (`Spindles_E1.edf`).
*   `modAL/` ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ scikit-learn).
*   `prepare_full_dataset.py` ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ –≤—Å–µ–º 19 –ø–∞—Ü–∏–µ–Ω—Ç–∞–º –∏ —Å–æ–∑–¥–∞–Ω–∏—è –µ–¥–∏–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.
*   `train_full_active.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –Ω–∞ 15 –ø–∞—Ü–∏–µ–Ω—Ç–∞—Ö —Å —Ç–µ—Å—Ç–æ–º –Ω–∞ 4 –Ω–æ–≤—ã—Ö.
*   `generate_ai_hints.py` ‚Äî —Å–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ **EDFbrowser**.

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –Ω–∞ –±–∞–∑–µ **Python 3.13**.

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è venv:**
   ```bash
   py -3.13 -m venv venv
   .\venv\Scripts\activate
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
   ```bash
   pip install mne scikit-learn scipy pandas numpy matplotlib torch skorch
   ```

## üöÄ –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–±–æ—Ä–∫—É –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏–∑ –≤—Å–µ—Ö 19 –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤. –°–∫—Ä–∏–ø—Ç –≤—ã–¥–µ–ª–∏—Ç —Å—Ç–∞–¥–∏—é N2, –Ω–∞—Ä–µ–∂–µ—Ç —Å–∏–≥–Ω–∞–ª –Ω–∞ —ç–ø–æ—Ö–∏ –∏ –∏–∑–≤–ª–µ—á–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ (RMS, Sigma Power, Sigma/Alpha Ratio).
```bash
.\venv\Scripts\python.exe prepare_full_dataset.py
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: —Ñ–∞–π–ª `full_dataset.npz`.

### –®–∞–≥ 2: –ê–∫—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ (SpindleNet)
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è. –ú–æ–¥–µ–ª—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é *Uncertainty Sampling*, –≤—ã–±–∏—Ä–∞—è –Ω–∞–∏–±–æ–ª–µ–µ ¬´–Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ¬ª –¥–ª—è –Ω–µ—ë —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.
```bash
.\venv\Scripts\python.exe train_full_active.py
```
–í –∫–æ–Ω—Ü–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –æ—Ç—á–µ—Ç –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º (F1-score, Precision, Recall) –Ω–∞ –Ω–æ–≤—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞—Ö.

### –®–∞–≥ 3: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ EDFbrowser
–ß—Ç–æ–±—ã –Ω–µ–π—Ä–æ—Å–µ—Ç—å ¬´–ø–æ–¥—Å–∫–∞–∑–∞–ª–∞¬ª –≤–∞–º, –≥–¥–µ –∏—Å–∫–∞—Ç—å –≤–µ—Ä–µ—Ç–µ–Ω–∞ –∏ –∞–Ω–æ–º–∞–ª–∏–∏ –Ω–∞ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
   ```bash
   .\venv\Scripts\python.exe generate_ai_hints.py
   ```
2. –û—Ç–∫—Ä–æ–π—Ç–µ `PSG.edf` –≤ **EDFbrowser**.
3. –ò–º–ø–æ—Ä—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π: `Tools` -> `Import annotations/events` -> `Import headerless ASCII annotations`.
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª `AI_HINTS_XXXX.txt`.
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∞: —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ‚Äî **tab**, —Å—Ç–æ–ª–±—Ü—ã: **1 (Onset)**, **2 (Description)**, **3 (Duration)**.

## üìä –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å **SpindleNet** (MLP):
* **–í—Ö–æ–¥:** 3 –ø—Ä–∏–∑–Ω–∞–∫–∞ (–∞–º–ø–ª–∏—Ç—É–¥–∞ –∏ —á–∞—Å—Ç–æ—Ç–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏).
* **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** 2 —Å–∫—Ä—ã—Ç—ã—Ö —Å–ª–æ—è (16 –∏ 8 –Ω–µ–π—Ä–æ–Ω–æ–≤) + Softmax.
* **Active Learning:** –°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–Ω—Ç—Ä–æ–ø–∏–∏ –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —á–µ—Ä–µ–∑ `ActiveLearner` –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `modAL`.

---
*–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ Active Learning –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.*
